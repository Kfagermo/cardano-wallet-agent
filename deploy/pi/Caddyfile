# Caddy reverse proxy for Wallet Health Agent on Raspberry Pi
# Replace your-domain.com with your real domain.
# Caddy will automatically obtain and renew TLS certs from Let's Encrypt.

crypto.esense.no {
    encode gzip zstd

    @health path /availability
    handle @health {
        reverse_proxy wallet-agent:8000
    }

    handle {
        reverse_proxy wallet-agent:8000 {
            # Increase timeouts slightly for cold path reads
            transport http {
                read_buffer 8192
                response_header_timeout 30s
                dial_timeout 5s
            }
            health_uri /availability
        }
    }

    header {
        # Basic security headers
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        X-Content-Type-Options "nosniff"
        X-Frame-Options "DENY"
        Referrer-Policy "no-referrer"
    }

    log {
        output stdout
        format json
        level INFO
    }
}

# If you donâ€™t have a domain yet and want to test on LAN without TLS:
# :80 {
#     encode gzip zstd
#     reverse_proxy wallet-agent:8000
# }
